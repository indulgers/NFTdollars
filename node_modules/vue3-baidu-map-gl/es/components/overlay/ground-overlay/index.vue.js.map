{"version":3,"file":"index.vue.js","sources":["../../../../packages/components/overlay/ground-overlay/index.vue"],"sourcesContent":["<template></template>\n\n<script setup lang=\"ts\">\n  import { defineEmits, nextTick, Ref, watch } from 'vue'\n  import useBaseMapEffect from '../../../hooks/useBaseMapEffect'\n  import useLifeCycle from '../../../hooks/useLifeCycle'\n  import { bindEvents, Callback, error, callWhenDifferentValue, type Point } from '../../../utils'\n  export type GroundOverlayUrl =\n    | string\n    | HTMLCanvasElement\n    | Ref<HTMLCanvasElement | string>\n    | (() => HTMLCanvasElement | Ref<HTMLCanvasElement | string>)\n\n  export interface GroundOverlayProps {\n    type: 'video' | 'canvas' | 'image'\n    url: GroundOverlayUrl\n    startPoint: Point\n    endPoint: Point\n    autoCenter?: boolean\n    opacity?: number\n    onClick?: Callback\n    onDblclick?: Callback\n    onMousemove?: Callback\n    onMouseover?: Callback\n    onMouseout?: Callback\n  }\n  const props = withDefaults(defineProps<GroundOverlayProps>(), {\n    autoCenter: false,\n    opacity: 1\n  })\n  const vueEmits = defineEmits(['initd', 'unload', 'click', 'dblclick', 'mousemove', 'mouseover', 'mouseout'])\n  const { ready } = useLifeCycle()\n  let groundOverlay: BMapGL.GroundOverlay\n  useBaseMapEffect((map) => {\n    const cal = () => {\n      groundOverlay && map.removeOverlay(groundOverlay)\n    }\n    const init = () => {\n      cal()\n      let { startPoint, endPoint, opacity, type, autoCenter } = props\n      const url = getUrl()\n      if (!url || !startPoint || !endPoint) return\n      const boundsObj = getBounds(startPoint, endPoint)\n      const options: BMapGL.GroundOverlayOptions = {\n        opacity,\n        type,\n        url: (url as Ref<HTMLCanvasElement>).value || url\n      }\n      groundOverlay = new BMapGL.GroundOverlay(boundsObj, options)\n      map.addOverlay(groundOverlay)\n      // 自动设置中心点\n      if (autoCenter) {\n        nextTick(() => {\n          // 获取中心点\n          try {\n            const center = boundsObj.getCenter()\n            map.panTo(center)\n          } catch (e) {\n            error('set center error')\n          }\n        })\n      }\n    }\n    init()\n    bindEvents(props, vueEmits, groundOverlay)\n    ready(map, groundOverlay)\n\n    watch(() => props, callWhenDifferentValue(init), { deep: true })\n    return cal\n  })\n  function getBounds(start: Point, end: Point) {\n    return new BMapGL.Bounds(new BMapGL.Point(start.lng, end.lat), new BMapGL.Point(end.lng, start.lat))\n  }\n  function getUrl() {\n    let url = props.url\n    if (typeof url === 'function') {\n      url = url()\n      if (!url && process.env.NODE_ENV === 'development') {\n        error(`expect a function return string or canvas html element, but got ${url}`)\n        return\n      }\n    }\n    return url\n  }\n</script>\n<script lang=\"ts\">\n  export default {\n    name: 'BGroundOverlay'\n  }\n</script>\n"],"names":[],"mappings":";;;;;AAsFE,oBAAe;AACb,IAAA,IAAI,EAAE,gBAAgB;CACvB,CAAA;;;;;;;;;;;;;;;AAzDD,QAAA,MAAM,EAAE,KAAK,EAAE,GAAG,YAAY,EAAE,CAAA;AAChC,QAAA,IAAI,aAAmC,CAAA;AACvC,QAAA,gBAAgB,CAAC,CAAC,GAAG,KAAI;YACvB,MAAM,GAAG,GAAG,MAAK;AACf,gBAAA,aAAa,IAAI,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,CAAA;AACnD,aAAC,CAAA;YACD,MAAM,IAAI,GAAG,MAAK;AAChB,gBAAA,GAAG,EAAE,CAAA;AACL,gBAAA,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG,KAAK,CAAA;AAC/D,gBAAA,MAAM,GAAG,GAAG,MAAM,EAAE,CAAA;AACpB,gBAAA,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ;oBAAE,OAAM;gBAC5C,MAAM,SAAS,GAAG,SAAS,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAA;AACjD,gBAAA,MAAM,OAAO,GAAgC;oBAC3C,OAAO;oBACP,IAAI;AACJ,oBAAA,GAAG,EAAG,GAA8B,CAAC,KAAK,IAAI,GAAG;iBAClD,CAAA;gBACD,aAAa,GAAG,IAAI,MAAM,CAAC,aAAa,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;AAC5D,gBAAA,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAA;;AAE7B,gBAAA,IAAI,UAAU,EAAE;oBACd,QAAQ,CAAC,MAAK;;wBAEZ,IAAI;AACF,4BAAA,MAAM,MAAM,GAAG,SAAS,CAAC,SAAS,EAAE,CAAA;AACpC,4BAAA,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;AAClB,yBAAA;AAAC,wBAAA,OAAO,CAAC,EAAE;4BACV,KAAK,CAAC,kBAAkB,CAAC,CAAA;AAC1B,yBAAA;AACH,qBAAC,CAAC,CAAA;AACH,iBAAA;AACH,aAAC,CAAA;AACD,YAAA,IAAI,EAAE,CAAA;AACN,YAAA,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAA;AAC1C,YAAA,KAAK,CAAC,GAAG,EAAE,aAAa,CAAC,CAAA;AAEzB,YAAA,KAAK,CAAC,MAAM,KAAK,EAAE,sBAAsB,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAA;AAChE,YAAA,OAAO,GAAG,CAAA;AACZ,SAAC,CAAC,CAAA;AACF,QAAA,SAAS,SAAS,CAAC,KAAY,EAAE,GAAU,EAAA;AACzC,YAAA,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAA;SACrG;AACD,QAAA,SAAS,MAAM,GAAA;AACb,YAAA,IAAI,GAAG,GAAG,KAAK,CAAC,GAAG,CAAA;AACnB,YAAA,IAAI,OAAO,GAAG,KAAK,UAAU,EAAE;gBAC7B,GAAG,GAAG,GAAG,EAAE,CAAA;gBACX,IAAI,CAAC,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,EAAE;AAClD,oBAAA,KAAK,CAAC,CAAA,gEAAA,EAAmE,GAAG,CAAA,CAAE,CAAC,CAAA;oBAC/E,OAAM;AACP,iBAAA;AACF,aAAA;AACD,YAAA,OAAO,GAAG,CAAA;SACX;;;;;;;;;;"}