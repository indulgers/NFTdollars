{"version":3,"file":"index.vue.js","sources":["../../../../packages/components/overlay/marker/index.vue"],"sourcesContent":["<template></template>\n\n<script setup lang=\"ts\">\n  import { defineProps, provide, watch, withDefaults } from 'vue'\n  import useBaseMapEffect from '../../../hooks/useBaseMapEffect'\n  import { bindEvents, Callback, isString, callWhenDifferentValue, isDef, Point } from '../../../utils/index'\n  import useLifeCycle from '../../../hooks/useLifeCycle'\n  import { useDefaultMarkerIcons } from '../../../hooks/useDefaultMarkerIcons'\n\n  export type MarkerIcons =\n    | 'simple_red'\n    | 'simple_blue'\n    | 'loc_red'\n    | 'loc_blue'\n    | 'start'\n    | 'end'\n    | 'location'\n    | 'red1'\n    | 'red2'\n    | 'red3'\n    | 'red4'\n    | 'red5'\n    | 'red6'\n    | 'red7'\n    | 'red8'\n    | 'red9'\n    | 'red10'\n    | 'blue1'\n    | 'blue2'\n    | 'blue3'\n    | 'blue4'\n    | 'blue5'\n    | 'blue6'\n    | 'blue7'\n    | 'blue8'\n    | 'blue9'\n    | 'blue10'\n  export interface MarkerOffset {\n    x: number\n    y: number\n  }\n  export type MarkerCustomIcon = {\n    anchor?: {\n      x: number\n      y: number\n    }\n    imageOffset?: {\n      x: number\n      y: number\n    }\n    imageSize: {\n      width: number\n      height: number\n    }\n    imageUrl: string\n    printImageUrl?: string\n  }\n  export interface MarkerProps {\n    position: Point\n    /**\n     * 标注的位置偏移值\n     */\n    offset?: MarkerOffset\n    /**\n     * 标注所用的图标对象\n     */\n    icon?: MarkerIcons | MarkerCustomIcon\n    /**\n     * 显示层级\n     */\n    zIndex?: number\n    /**\n     * @default true\n     * 是否在调用map.clearOverlays清除此覆盖物，默认为true\n     */\n    enableMassClear?: boolean\n    /**\n     * @default false\n     * 是否启用拖拽，默认为false\n     */\n    enableDragging?: boolean\n    /**\n     * @default true\n     * 是否响应点击事件。默认为true\n     */\n    enableClicking?: boolean\n    /**\n     * @default false\n     * 拖拽标注时，标注是否开启离开地图表面效果。默认为false\n     */\n    raiseOnDrag?: boolean\n    /**\n     * 拖拽标注时的鼠标指针样式。此属性值需遵循CSS的cursor属性规范\n     */\n    draggingCursor?: string\n    /**\n     * 旋转角度\n     */\n    rotation?: number\n    /**\n     * 鼠标移到marker上的显示内容\n     */\n    title?: string\n    onClick?: Callback\n    onDblclick?: Callback\n    onMousedown?: Callback\n    onMouseup?: Callback\n    onMouseout?: Callback\n    onMouseover?: Callback\n    onRemove?: Callback\n    onInfowindowclose?: Callback\n    onInfowindowopen?: Callback\n    onDragstart?: Callback\n    onDragging?: Callback\n    onDragend?: Callback\n    onRightClick?: Callback\n  }\n\n  const props = withDefaults(defineProps<MarkerProps>(), {\n    offset: () => ({\n      x: 0,\n      y: 0\n    }),\n    enableMassClear: true,\n    enableDragging: false,\n    enableClicking: true,\n    raiseOnDrag: false,\n    draggingCursor: 'pointer',\n    rotation: 0,\n    title: ''\n  })\n  const vueEmits = defineEmits([\n    'initd',\n    'unload',\n    'click',\n    'dblclick',\n    'mousedown',\n    'mouseup',\n    'mouseout',\n    'mouseover',\n    'remove',\n    'infowindowclose',\n    'infowindowopen',\n    'dragstart',\n    'dragging',\n    'dragend',\n    'rightclick'\n  ])\n  const { ready } = useLifeCycle()\n  let marker: BMapGL.Marker\n\n  useBaseMapEffect((map: BMapGL.Map) => {\n    const cal = () => {\n      marker && map.removeOverlay(marker)\n    }\n    const init = () => {\n      if (!props.position) return\n      const {\n        position,\n        offset,\n        enableMassClear,\n        enableDragging,\n        enableClicking,\n        raiseOnDrag,\n        draggingCursor,\n        rotation,\n        title,\n        icon,\n        zIndex\n      } = props\n      const options: BMapGL.MarkerOptions = {\n        offset: new BMapGL.Size(offset.x, offset.y),\n        enableMassClear,\n        enableDragging,\n        enableClicking,\n        raiseOnDrag,\n        draggingCursor,\n        title\n      }\n      if (icon) {\n        options.icon = getIconConfig()\n      }\n      marker = new BMapGL.Marker(new BMapGL.Point(position.lng, position.lat), options)\n      setRotation(rotation)\n      isDef(zIndex) && setZIndex(zIndex!)\n      // 在地图上添加点标记\n      map.addOverlay(marker)\n      bindEvents(props, vueEmits, marker)\n      ready(map, marker)\n    }\n\n    init()\n    // 监听值变化\n    watch(\n      () => props.position,\n      callWhenDifferentValue((n) => {\n        marker ? setPosition(n) : init()\n      }),\n      { deep: true }\n    )\n    watch(() => props.icon, callWhenDifferentValue(setIcon), { deep: true })\n    watch(() => props.offset, callWhenDifferentValue(setOffset), { deep: true })\n    watch(() => props.enableDragging, setDragging)\n    watch(() => props.enableMassClear, setMassClear)\n    watch(() => props.rotation, setRotation)\n    return cal\n  })\n\n  provide('getOverlayInstance', () => marker)\n\n  // 获取图标配置\n  function getIconConfig(): BMapGL.Icon {\n    const defaultIcons = useDefaultMarkerIcons()\n    const { icon } = props\n    if (isString(icon) && defaultIcons[icon as string]) {\n      return defaultIcons[icon as string]\n    } else {\n      // @ts-ignore\n      const { anchor, imageOffset, imageSize, imageUrl, printImageUrl } = icon as MarkerCustomIcon\n      const iconOptions: BMapGL.IconOptions = {\n        imageSize: new BMapGL.Size(imageSize.width, imageSize.height)\n      }\n      if (anchor) {\n        iconOptions.anchor = new BMapGL.Size(anchor.x, anchor.y)\n      }\n      if (imageOffset) {\n        iconOptions.imageOffset = new BMapGL.Size(imageOffset.x, imageOffset.y)\n      }\n      if (printImageUrl) {\n        iconOptions.printImageUrl = printImageUrl\n      }\n      return new BMapGL.Icon(imageUrl, new BMapGL.Size(imageSize.width, imageSize.height), iconOptions)\n    }\n  }\n  function setZIndex(zIndex: number) {\n    marker.setZIndex(zIndex)\n  }\n  function setPosition(position: Point) {\n    position && position.lat && position.lng && marker.setPosition(new BMapGL.Point(position.lng, position.lat))\n  }\n  function setIcon() {\n    marker.setIcon(getIconConfig())\n  }\n  function setDragging(enableDragging: boolean): void {\n    enableDragging ? marker!.enableDragging() : marker!.disableDragging()\n  }\n  function setMassClear(enableMassClear: boolean): void {\n    enableMassClear ? marker!.enableMassClear() : marker!.disableMassClear()\n  }\n  function setOffset(offset: MarkerOffset) {\n    marker.setOffset(new BMapGL.Size(offset.x, offset.y))\n  }\n  function setRotation(rotation: number) {\n    marker.setRotation(rotation)\n  }\n</script>\n<script lang=\"ts\">\n  export default {\n    name: 'BMarker'\n  }\n</script>\n"],"names":[],"mappings":"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"}