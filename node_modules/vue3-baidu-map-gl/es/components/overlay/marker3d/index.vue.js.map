{"version":3,"file":"index.vue.js","sources":["../../../../packages/components/overlay/marker3d/index.vue"],"sourcesContent":["<template></template>\n\n<script setup lang=\"ts\">\n  import { defineProps, provide, watch, withDefaults } from 'vue'\n  import useBaseMapEffect from '../../../hooks/useBaseMapEffect'\n  import useLifeCycle from '../../../hooks/useLifeCycle'\n  import { bindEvents, Callback, callWhenDifferentValue, type Point } from '../../../utils'\n  export type Marker3dCustomIcon = {\n    anchor?: {\n      x: number\n      y: number\n    }\n    imageOffset?: {\n      x: number\n      y: number\n    }\n    imageSize: {\n      width: number\n      height: number\n    }\n    imageUrl: string\n    printImageUrl?: string\n  }\n  export type Marker3dShape = 'BMAP_SHAPE_CIRCLE' | 'BMAP_SHAPE_RECT'\n  export interface Marker3dProps {\n    /**\n     * 位置\n     */\n    position: Point\n    /**\n     * 点高度\n     */\n    height: number\n    /**\n     * 点大小\n     */\n    size?: number\n    /**\n     * 点形状\n     */\n    shape?: Marker3dShape\n    /**\n     * 点填充颜色，同CSS颜色\n     */\n    fillColor?: string\n\n    /**\n     * 点填充的透明度，范围0-1\n     */\n    fillOpacity?: number\n    /**\n     * 标注所用的图标对象\n     */\n    icon?: Marker3dCustomIcon\n    /**\n     * @default true\n     * 是否在调用map.clearOverlays清除此覆盖物，默认为true\n     */\n    enableMassClear?: boolean\n    onClick?: Callback\n    onDblclick?: Callback\n    onMousedown?: Callback\n    onMouseup?: Callback\n    onMouseout?: Callback\n    onMouseover?: Callback\n    onRemove?: Callback\n    onRightClick?: Callback\n  }\n\n  const props = withDefaults(defineProps<Marker3dProps>(), {\n    enableMassClear: true,\n    size: 50,\n    shape: 'BMAP_SHAPE_CIRCLE',\n    fillColor: '#f00',\n    fillOpacity: 0.8\n  })\n  const vueEmits = defineEmits([\n    'initd',\n    'unload',\n    'click',\n    'dblclick',\n    'mousedown',\n    'mouseup',\n    'mouseout',\n    'mouseover',\n    'remove',\n    'rightclick'\n  ])\n  const { ready } = useLifeCycle()\n  let marker3d: BMapGL.Marker3D\n\n  useBaseMapEffect((map: BMapGL.Map) => {\n    const cal = () => {\n      map.removeOverlay(marker3d)\n    }\n    const init = () => {\n      if (!props.position || !props.height) return\n      const { position, shape, fillColor, fillOpacity, size, icon, height, enableMassClear } = props\n      const options: BMapGL.Marker3DOptions = {\n        size,\n        fillColor,\n        fillOpacity,\n        shape: window[shape]\n      }\n      if (icon) {\n        options.icon = getIconConfig()\n      }\n      marker3d = new BMapGL.Marker3D(new BMapGL.Point(position.lng, position.lat), height, options)\n      // 在地图上添加点标记\n      map.addOverlay(marker3d)\n      setMassClear(enableMassClear)\n      bindEvents(props, vueEmits, marker3d)\n      ready(map, marker3d)\n    }\n\n    init()\n    // 监听值变化\n    watch(\n      () => props.position,\n      callWhenDifferentValue((n) => {\n        marker3d ? setPosition(n) : init()\n      }),\n      { deep: true }\n    )\n    watch(\n      () => props.height,\n      (n) => {\n        marker3d ? setHeight(n) : init()\n      }\n    )\n    watch(() => props.enableMassClear, setMassClear)\n    watch(() => props.icon, callWhenDifferentValue(setIcon), { deep: true })\n    watch(() => props.enableMassClear, setMassClear)\n    watch(() => props.fillOpacity, setFillOpacity)\n    watch(() => props.fillColor, setFillColor)\n    return cal\n  })\n\n  provide('getOverlayInstance', () => marker3d)\n\n  // 获取图标配置\n  function getIconConfig(): BMapGL.Icon {\n    const { icon } = props\n    // @ts-ignore\n    const { anchor, imageOffset, imageSize, imageUrl, printImageUrl } = icon as MarkerCustomIcon\n    const iconOptions: BMapGL.IconOptions = {\n      imageSize: new BMapGL.Size(imageSize.width, imageSize.height)\n    }\n    if (anchor) {\n      iconOptions.anchor = new BMapGL.Size(anchor.x, anchor.y)\n    }\n    if (imageOffset) {\n      iconOptions.imageOffset = new BMapGL.Size(imageOffset.x, imageOffset.y)\n    }\n    if (printImageUrl) {\n      iconOptions.printImageUrl = printImageUrl\n    }\n    return new BMapGL.Icon(imageUrl, new BMapGL.Size(imageSize.width, imageSize.height), iconOptions)\n  }\n  function setPosition(position: Point) {\n    try {\n      // FIXME: 更新 position baidu-map-gl api报错: TypeError: Cannot read properties of undefined (reading '2x')\n      marker3d.setPosition(new BMapGL.Point(position.lng, position.lat))\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  function setHeight(height: number) {\n    marker3d.setHeight(height)\n  }\n  function setFillColor(color: string): void {\n    marker3d.setFillColor(color)\n  }\n  function setFillOpacity(opacity: number): void {\n    marker3d.setFillOpacity(opacity)\n  }\n  function setIcon() {\n    marker3d.setIcon(getIconConfig())\n  }\n  function setMassClear(enableMassClear: boolean): void {\n    enableMassClear ? marker3d!.enableMassClear() : marker3d!.disableMassClear()\n  }\n</script>\n<script lang=\"ts\">\n  export default {\n    name: 'BMarker3d'\n  }\n</script>\n"],"names":[],"mappings":"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"}