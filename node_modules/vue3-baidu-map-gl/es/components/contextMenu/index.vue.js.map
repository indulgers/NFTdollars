{"version":3,"file":"index.vue.js","sources":["../../../packages/components/contextMenu/index.vue"],"sourcesContent":["<template></template>\n\n<script setup lang=\"ts\">\n  import { defineProps, watch, withDefaults } from 'vue'\n  import useBaseMapEffect from '../../hooks/useBaseMapEffect'\n  import useLifeCycle from '../../hooks/useLifeCycle'\n  import { bindEvents, Callback, isString, callWhenDifferentValue } from '../../utils/index'\n  export interface ContextMenuItem {\n    text: string\n    callback: (...arg: any[]) => void\n    disabled?: boolean\n  }\n  export type ContextMenuSeparator = '-'\n  export interface ContextMenuProps {\n    width?: number\n    menuItems?: (ContextMenuItem | ContextMenuSeparator)[]\n    onOpen?: Callback\n    onClose?: Callback\n  }\n  const props = withDefaults(defineProps<ContextMenuProps>(), {\n    width: 100,\n    menuItems: () => []\n  })\n\n  // const getParentInstance = inject('getOverlayInstance', () => null)\n  const vueEmits = defineEmits(['initd', 'unload', 'open', 'close'])\n  const { ready } = useLifeCycle()\n  let contextMenu: BMapGL.ContextMenu\n  useBaseMapEffect((map: BMapGL.Map) => {\n    // const target = getParentInstance() || map\n    const target = map\n    const cal = () => {\n      contextMenu && target.removeContextMenu(contextMenu)\n    }\n    const init = () => {\n      const { width, menuItems } = props\n      contextMenu = new BMapGL.ContextMenu()\n      for (const item of menuItems) {\n        if (isString(item) && item === '-') {\n          contextMenu.addSeparator()\n          continue\n        }\n        const menuItem = new BMapGL.MenuItem(\n          (item as ContextMenuItem).text,\n          function (point, pixel) {\n            ;(item as ContextMenuItem).callback.call(null, {\n              point,\n              pixel,\n              map,\n              BMapGL,\n              target: target\n            })\n          },\n          {\n            width,\n            id: String(Math.random())\n          }\n        )\n        ;(item as ContextMenuItem).disabled ? menuItem.disable() : menuItem.enable()\n        contextMenu.addItem(menuItem)\n      }\n      target.addContextMenu(contextMenu)\n      bindEvents(props, vueEmits, contextMenu)\n    }\n    watch(\n      () => {\n        return props.menuItems\n      },\n      callWhenDifferentValue(() => {\n        cal()\n        init()\n      }),\n      {\n        deep: true\n      }\n    )\n    init()\n    ready(map, contextMenu)\n    // 在地图上添加点标记\n    return cal\n  })\n</script>\n\n<script lang=\"ts\">\n  export default {\n    name: 'BContextMenu'\n  }\n</script>\n"],"names":[],"mappings":";;;;;AAoFE,oBAAe;AACb,IAAA,IAAI,EAAE,cAAc;CACrB,CAAA;;;;;;;;;AA5DD,QAAA,MAAM,EAAE,KAAK,EAAE,GAAG,YAAY,EAAE,CAAA;AAChC,QAAA,IAAI,WAA+B,CAAA;AACnC,QAAA,gBAAgB,CAAC,CAAC,GAAe,KAAI;;YAEnC,MAAM,MAAM,GAAG,GAAG,CAAA;YAClB,MAAM,GAAG,GAAG,MAAK;AACf,gBAAA,WAAW,IAAI,MAAM,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAA;AACtD,aAAC,CAAA;YACD,MAAM,IAAI,GAAG,MAAK;AAChB,gBAAA,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,KAAK,CAAA;AAClC,gBAAA,WAAW,GAAG,IAAI,MAAM,CAAC,WAAW,EAAE,CAAA;AACtC,gBAAA,KAAK,MAAM,IAAI,IAAI,SAAS,EAAE;oBAC5B,IAAI,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,GAAG,EAAE;wBAClC,WAAW,CAAC,YAAY,EAAE,CAAA;wBAC1B,SAAQ;AACT,qBAAA;AACD,oBAAA,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,QAAQ,CACjC,IAAwB,CAAC,IAAI,EAC9B,UAAU,KAAK,EAAE,KAAK,EAAA;AAClB,wBAAA,IAAwB,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE;4BAC7C,KAAK;4BACL,KAAK;4BACL,GAAG;4BACH,MAAM;AACN,4BAAA,MAAM,EAAE,MAAM;AACf,yBAAA,CAAC,CAAA;AACJ,qBAAC,EACD;wBACE,KAAK;AACL,wBAAA,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;AAC1B,qBAAA,CACF,CACA;AAAC,oBAAA,IAAwB,CAAC,QAAQ,GAAG,QAAQ,CAAC,OAAO,EAAE,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAA;AAC5E,oBAAA,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA;AAC9B,iBAAA;AACD,gBAAA,MAAM,CAAC,cAAc,CAAC,WAAW,CAAC,CAAA;AAClC,gBAAA,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAA;AAC1C,aAAC,CAAA;YACD,KAAK,CACH,MAAK;gBACH,OAAO,KAAK,CAAC,SAAS,CAAA;AACxB,aAAC,EACD,sBAAsB,CAAC,MAAK;AAC1B,gBAAA,GAAG,EAAE,CAAA;AACL,gBAAA,IAAI,EAAE,CAAA;AACR,aAAC,CAAC,EACF;AACE,gBAAA,IAAI,EAAE,IAAI;AACX,aAAA,CACF,CAAA;AACD,YAAA,IAAI,EAAE,CAAA;AACN,YAAA,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC,CAAA;;AAEvB,YAAA,OAAO,GAAG,CAAA;AACZ,SAAC,CAAC,CAAA;;;;;;;;;;"}