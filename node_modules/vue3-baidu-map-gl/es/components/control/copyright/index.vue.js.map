{"version":3,"file":"index.vue.js","sources":["../../../../packages/components/control/copyright/copyrightControlPosCacheMap.ts","../../../../packages/components/control/copyright/index.vue"],"sourcesContent":["const copyrightControlPosCacheMap: Record<string, BMapGL.CopyrightControl> = {} as const\n\nexport default copyrightControlPosCacheMap\n","<template>\n  <div style=\"display: none\">\n    <div ref=\"copyrightContainer\" v-bind=\"$attrs\">\n      <slot></slot>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n  import { defineProps, withDefaults, defineEmits, onMounted, ref, getCurrentInstance, onUpdated } from 'vue'\n  import useBaseMapEffect from '../../../hooks/useBaseMapEffect'\n  import useLifeCycle from '../../../hooks/useLifeCycle'\n  import copyrightControlPosCacheMap from './copyrightControlPosCacheMap'\n  import { type ControlAnchor } from '../../../utils'\n  export interface CopyrightProps {\n    /**\n     * 控件的停靠位置\n     */\n    anchor?: ControlAnchor\n    /**\n     * 控件的偏移值\n     */\n    offset?: {\n      x: number\n      y: number\n    }\n  }\n  const props = withDefaults(defineProps<CopyrightProps>(), {\n    anchor: 'BMAP_ANCHOR_BOTTOM_RIGHT',\n    offset: () => ({ x: 83, y: 18 })\n  })\n  const { ready } = useLifeCycle()\n  const copyrightContainer = ref<HTMLDivElement>()\n  let copyrightControl: BMapGL.CopyrightControl\n  const uid = getCurrentInstance()?.uid\n  defineEmits(['initd', 'unload'])\n  onMounted(() => {\n    const { anchor, offset } = props\n    useBaseMapEffect((map: BMapGL.Map) => {\n      if (!copyrightContainer.value) return\n      let mapBounds = map.getBounds()\n      // 同一位置的 copyright 应该调用 addCopyright,防止多个 copyright 重叠\n      if (!(copyrightControl = copyrightControlPosCacheMap[anchor])) {\n        copyrightControl = new BMapGL.CopyrightControl({\n          offset: new BMapGL.Size(offset.x, offset.y),\n          anchor: window[anchor]\n        })\n        copyrightControlPosCacheMap[anchor] = copyrightControl\n        map.addControl(copyrightControl)\n      }\n      copyrightControl.addCopyright({\n        id: uid,\n        content: copyrightContainer.value.innerHTML,\n        bounds: mapBounds\n      })\n\n      ready(map, copyrightControl)\n      return () => {\n        const cacheCopyright = copyrightControlPosCacheMap[anchor]\n        const getCopyrightCollection = cacheCopyright?.getCopyrightCollection?.bind(cacheCopyright)\n\n        if (getCopyrightCollection && getCopyrightCollection()?.length > 1) {\n          cacheCopyright.removeCopyright(uid!)\n        } else {\n          map.removeControl(cacheCopyright)\n          Reflect.deleteProperty(copyrightControlPosCacheMap, anchor)\n        }\n      }\n    })\n  })\n  onUpdated(() => {\n    if (!copyrightControl) return\n    let copyright = copyrightControl?.getCopyright(uid!)\n    if (copyright?.content !== copyrightContainer.value?.innerHTML) {\n      copyrightControl.addCopyright({\n        id: uid,\n        content: copyrightContainer.value?.innerHTML,\n        bounds: copyright.bounds\n      })\n    }\n  })\n</script>\n<script lang=\"ts\">\n  export default {\n    name: 'BCopyright',\n    inheritAttrs: false\n  }\n</script>\n"],"names":[],"mappings":"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"}