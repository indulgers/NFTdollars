import { getCurrentInstance, onUnmounted } from 'vue';
import useBaseMapListener from './useBaseMapListener';

function useLifeCycle() {
    const { uid, emit: VueEmit } = getCurrentInstance();
    const { on, emit, off } = useBaseMapListener();
    const eventKey = `__initd__${uid}`;
    on(eventKey, (instance) => {
        VueEmit('initd', instance);
    });
    onUnmounted(() => {
        VueEmit('unload');
        off(eventKey);
    });
    return {
        ready: (map, instance) => {
            emit(eventKey, {
                map,
                instance,
                BMapGL: window.BMapGL
            });
        }
    };
}

export { useLifeCycle as default };
