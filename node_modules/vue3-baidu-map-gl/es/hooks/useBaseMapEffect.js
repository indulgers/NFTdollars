import { inject, getCurrentInstance, onUnmounted } from 'vue';
import useBaseMapListener from './useBaseMapListener';

function useBaseMapEffect(cal) {
    var _a;
    const { on, off } = useBaseMapListener();
    const getMapInstance = inject('getMapInstance');
    const parentUidGetter = inject('parentUidGetter');
    const uid = parentUidGetter || ((_a = getCurrentInstance()) === null || _a === void 0 ? void 0 : _a.uid);
    const map = getMapInstance && getMapInstance();
    const eventKey = `__initd__${uid}`;
    let onUnmountedCallback;
    const _cal = ({ map }) => {
        onUnmountedCallback = cal(map);
    };
    if (map) {
        _cal({ map });
    }
    else {
        on(eventKey, _cal);
    }
    onUnmounted(() => {
        off(eventKey, _cal);
        onUnmountedCallback && onUnmountedCallback();
    });
}

export { useBaseMapEffect as default };
